<!DOCTYPE html>

<head>
</head>
<html>

<button type="button" onclick="linkGitHub()">Link GitHub</button>

<script type="text/javascript">
    function linkGitHub() {
        'use strict';

        var url = new URL(window.location.href);
        var json = JSON.parse(url.searchParams.get("token_json"));
        console.log("Token JSON: " + json.access_token);

        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var locationJSON = JSON.parse(this.responseText);
                console.log("Redirect location: " + locationJSON.redirect_location);
                window.location.href = locationJSON.redirect_location;
            }
        };
        xhttp.open("GET", "http://localhost:8089/api/token/link?for=https://github.com&redirect=http://localhost:8090/linked.html", true);
        xhttp.setRequestHeader("Authorization", "Bearer " + json.access_token);
        xhttp.send();
    }
</script>

</html>